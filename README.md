# 图腾纷争 - AI协作开发指南

本文档是 tower-html 项目的 AI 协作开发入口，包含项目背景和开发指南。

---

## AI Agent Team 配置

本项目采用AI Agent Team协作开发模式。通过模拟AI玩家游戏体验，持续发现bug、优化数值平衡、改进游戏机制。

### 团队架构

```
┌───────────────────────────────────────────────────────────────────────┐
│                         项目总监 (你)                                  │
│                       Project Director                                │
│            职责：直接向用户汇报，协调团队成员，分配任务                   │
└─────────────────────┬─────────────────────────────────────────────────┘
                      │ 分配任务 / 汇总报告
    ┌─────────────────┼─────────────────┐
    ▼                 ▼                 ▼
┌──────────┐  ┌──────────────┐  ┌──────────┐
│ AI Agent │  │  游戏策划组   │  │ 游戏开发  │
│  玩家    │  │              │  │          │
│          │  │ ┌──────────┐ │  │          │
│ 读取日志 │  │ │ 主策划   │ │  │ Bug修复  │
│ 输出操作 │  │ │ (机制)   │ │  │ 功能实现 │
│ 反馈体验 │  │ ├──────────┤ │  │ 日志增强 │
└────┬─────┘  │ │ 副策划   │ │  └────┬─────┘
     │        │ │ (数值)   │ │       │
     │        │ └──────────┘ │       │
     │        └──────┬───────┘       │
     │               │               │
     └───────────────┴───────────────┘
                         │
                    ┌────┴────┐
                    ▼         ▼
               游戏日志    代码仓库
```

### 团队成员

| 角色 | 名称 | 职责 | 工作目录 |
|------|------|------|----------|
| **项目总监** | `team-lead` | 协调团队、分配任务、向用户汇报 | 项目根目录 |
| **AI Agent玩家** | `ai-player` | 模拟真实玩家体验、根据日志进行游戏决策、反馈日志缺失 | `docs/agents/ai-player/` |
| **游戏策划（机制）** | `game-designer` | 机制设计、流派设计、系统设计 | `docs/agents/game-designer/` |
| **游戏策划（数值）** | `game-designer-2` | 数值平衡、成长曲线、关卡设计 | `docs/agents/game-designer-2/` |
| **游戏开发** | `game-developer` | Bug修复、功能实现、日志增强 | `docs/agents/game-developer/` |

### AI Agent玩家详细职责

AI Agent玩家作为**文字版游戏的实际玩家**，需要：

1. **真实游戏体验**
   - 将游戏日志视为文字版游戏进行游玩
   - 根据当前金币、法力、场上单位状态做出真实决策
   - 在商店阶段进行真实的购买、刷新、合成操作
   - 构建实际可行的流派组合（如狼图腾魂魄流、蝙蝠图腾吸血流等）

2. **反馈日志不明确之处**
   - 发现日志描述模糊、难以理解时立即反馈
   - 标记数值没有单位、状态变化缺少上下文等问题
   - 举例：`[Combat] Unit dealt damage` 缺少具体伤害数值和来源

3. **反馈缺失的关键信息**
   - 发现需要但日志未打印的信息时向游戏开发人员反馈
   - 包括但不限于：
     - 敌人移动路径和预计到达时间
     - 单位攻击范围和实际攻击目标
     - 技能冷却倒计时
     - 商店下次刷新预览
     - 流派羁绊激活状态

4. **体验反馈**
   - 从真实玩家角度反馈爽点、坑点
   - 报告 confusing 的游戏机制
   - 提出改进建议

### 游戏策划分工

| 策划角色 | 主要职责 | 当前任务 |
|----------|----------|----------|
| **主策划（机制）** | 流派设计、机制设计、系统架构 | 蝙蝠图腾综合方案设计 |
| **副策划（数值）** | 数值平衡、成长曲线、关卡难度 | 波次系统设计、遗物系统设计 |

### 团队工作流程

```
┌────────────────────────────────────────────────────────────────┐
│  Phase 1: 游戏运行（文字版）                                    │
│  ───────────────────────────                                    │
│  Godot引擎运行游戏，输出详细日志到终端                           │
│  AI Agent玩家读取日志，将其视为"文字版游戏"进行游玩               │
│                                                                │
│  示例日志：                                                     │
│  [Shop] Gold: 150, Available: [wolf,bat,eagle]                  │
│  [Combat] wolf dealt 25 damage to slime                         │
│       │                                                        │
│       ▼                                                        │
│  Phase 2: AI玩家决策与体验反馈                                   │
│  ────────────────────────────                                   │
│  AI Agent玩家作为真实玩家：                                      │
│   ├─► 分析当前状态（金币、单位、敌人波次）                        │
│   ├─► 做出游戏决策（购买/放置/升级/合成）                         │
│   │      理由：当前有2个狼，再买1个激活羁绊                       │
│   ├─► 反馈日志不明确之处                                        │
│   │      "[Combat] Unit dealt damage" - 未指明单位和数值         │
│   ├─► 反馈缺失的关键信息                                        │
│   │      "需要显示敌人预计到达时间"                              │
│   └─► 报告Bug和体验问题                                         │
│       │                                                        │
│       ▼                                                        │
│  Phase 3: 分析与设计                                            │
│  ──────────────────                                             │
│  游戏策划组 ←── 分析AI玩家的游戏决策和反馈                         │
│   主策划 ──► 机制设计、流派方案（是否容易理解和构建）              │
│   副策划 ──► 数值平衡、成长曲线（购买决策是否合理）                │
│       │                                                        │
│       ▼                                                        │
│  Phase 4: 实现与修复                                            │
│  ──────────────────                                             │
│  游戏开发 ←──── 接收设计方案和日志问题                            │
│        ──► 修复Bug                                              │
│        ──► 完善日志输出（添加AI玩家反馈的缺失信息）                │
│        ──► 实现新功能                                           │
│       │                                                        │
│       ▼                                                        │
│  Phase 5: 验证循环                                              │
│  ─────────────────                                              │
│  项目总监 ──► 验证修复效果                                       │
│        ──► 向用户汇报进度                                       │
│        ──► 启动下一轮测试（AI玩家继续游玩验证）                   │
└────────────────────────────────────────────────────────────────┘
```

**关键原则**：
- AI Agent玩家必须**像真实玩家一样思考**，做出合理的游戏决策
- 每个决策必须有**明确的理由**（基于当前游戏状态）
- 日志不明确时必须**立即反馈**，不能猜测
- 流派构建必须是**实际可行**的，而非理论组合

**项目总监必须推进整体任务进度，在未收到用户明确指令的情况下，严禁停止队伍。**

### 快速启动AI Agent Team

#### 1. 初始化团队

```bash
# 创建AI Agent工作目录
mkdir -p docs/agents/{ai-player,game-designer,game-developer}

# 团队已配置，直接使用以下命令启动协作
```

#### 2. 运行游戏并输出日志

```bash
# 运行游戏并输出详细日志（文字版）
godot --path . --headless -- --run-test=ai_player_test --verbose-logging

# 日志输出位置
cat docs/logs/ai_player_session.log
```

#### 3. 分配任务给团队成员

```bash
# 示例：分配任务给AI Agent Team
# 在Claude Code中使用 Team/Agent 功能分配任务

# 1. AI Agent玩家进行真实游戏体验
claude task assign ai-player "作为真实玩家进行一轮完整游戏（1-5波），
根据日志信息做出商店购买、单位放置、流派构建等决策。
记录每个决策的理由，并反馈日志中缺失或不清楚的信息。"

# 2. AI Agent玩家测试特定流派
claude task assign ai-player "目标：构建并测试蝙蝠图腾吸血流派。
要求：
- 商店优先购买蝙蝠图腾单位
- 至少收集4个蝙蝠图腾单位激活羁绊
- 验证吸血效果是否能在战斗中回复核心生命
- 反馈吸血数值是否清晰显示在日志中"

# 3. 游戏策划（机制）设计系统
claude task assign game-designer "设计蝙蝠图腾流派的完整机制方案"

# 4. 游戏策划（数值）平衡调整
claude task assign game-designer-2 "根据AI玩家反馈，分析数值平衡问题并提出调整方案"

# 5. 游戏开发修复实现
claude task assign game-developer "修复AI玩家发现的日志缺失问题，添加xxx事件的日志输出"
```

### 日志输出规范

为确保AI Agent玩家能够准确理解游戏状态，游戏需要输出以下类型的日志：

#### 商店阶段日志
```
[Shop] Wave 3 ended, entering shop phase
[Shop] Gold: 150, Mana: 500/1000
[Shop] Available units: [wolf, bat, butterfly, cobra, eagle, cow]
[Shop] Shop refresh cost: 10 gold
[Shop] Player purchased unit 'wolf' at position (1, 0)
```

#### 战斗阶段日志
```
[Wave] Wave 4 started, enemy count: 15
[Spawn] Enemy 'slime' spawned at position (100, 200), HP: 50
[Combat] Unit 'wolf' at (1,0) attacks enemy 'slime' for 25 damage
[Combat] Enemy 'slime' died, killer: 'wolf', souls gained: 1
[Core] Base took 10 damage, current HP: 490/500
```

#### 单位状态日志
```
[Unit] Unit 'wolf' upgraded to level 2, damage: 25 -> 35
[Unit] Unit 'bat' applied bleed to enemy 'goblin', stacks: 3
[Unit] Unit 'tiger' devoured unit 'wolf', inherited: +15 damage
[Skill] Skill 'meteor_shower' activated at position (2, 1)
```

### AI Agent玩家输出格式

AI Agent玩家每次响应应包含以下部分：

```markdown
## 当前游戏状态（基于日志理解）
**波次信息**：
- 当前波次：第4波进行中 / 商店阶段
- 核心血量：490/500
- 金币：150 | 法力：500/1000

**场上单位**：
- wolf(2,0) Lv2, HP: 80/100, 攻击CD: 0.5s
- bat(0,1) Lv1, 流血层数: 3

**商店状态（如果是商店阶段）**：
- 可用单位：[wolf, bat, butterfly, cobra, eagle, cow]
- 刷新成本：10金币
- 当前流派构建进度：狼图腾(2/4), 蝙蝠图腾(1/3)

**敌人生成**：
- 已生成：15只slime
- 预计到达核心：3秒后
- 威胁评估：低（当前防御足够）

## 本回合决策（基于真实玩家思考）
### 分析：
- 当前核心血量较低（490/500），需要防御
- 已有狼图腾2个单位，再买一个可激活羁绊
- 金币充足（150），刷新商店寻找狼单位

### 操作计划：
1. 花费10金币刷新商店
2. 购买wolf单位（如果刷新出）
3. 放置在位置(-1,0)增强左翼防御
4. 剩余金币保留用于升级

### 预期效果：
- 激活狼图腾羁绊（3个单位）
- 魂魄收集效率提升
- 核心防御加强

## 日志问题反馈
### 不明确的地方：
- [日志问题] `[Combat] Unit dealt damage` - 未指明具体单位和伤害数值
- [日志问题] 商店刷新后未显示新单位的价格

### 缺失的关键信息（需要开发人员添加）：
- [信息缺失] 敌人移动路径和预计到达时间
- [信息缺失] 单位攻击范围显示
- [信息缺失] 狼图腾羁绊当前层数和效果

## 体验反馈
- **爽点**：暴击时的视觉反馈很明显，从日志中能感受到伤害跳字
- **坑点**：不知道敌人的移动路径，难以预判放置位置
- **建议**：希望在商店阶段显示已拥有的单位数量
```



### 团队沟通规范

1. **任务分配**：项目总监使用 `SendMessage` 向指定Agent分配任务
2. **进度汇报**：各Agent完成任务后向项目总监汇报
3. **问题升级**：Agent遇到阻塞问题时立即上报项目总监
4. **文档更新**：所有设计决策和修复记录需同步到相关文档

---

## 项目信息

| 属性 | 值 |
|------|-----|
| **项目名称** | tower-html - 图腾纷争 |
| **引擎** | Godot 4.x |
| **类型** | 塔防游戏 |
| **GitHub** | https://github.com/seekerzz/tower-html |

## 

---

### 坐标系与核心区规则

**重要：测试用例编写时必须遵守以下规则**

| 区域 | 坐标范围 | 说明 |
|------|----------|------|
| **核心区** | (0, 0) | **禁止放置任何单位**，这是图腾核心所在位置 |
| 初始格子 | 紧邻 (0,0) 的4格 | 开局已解锁的格子 |
| 可扩建区域 | x∈[-2,2], y∈[-2,2] | 中心5×5区域，需消耗金币解锁 |

> ⚠️ **测试用例常见错误**: 将单位放置在 `(0, 0)` 坐标
>
> 错误示例：`{"id": "medusa", "x": 0, "y": 0}`
>
> 正确做法：使用 `(1, 0)`、`(0, 1)`、`(-1, 0)` 或 `(0, -1)` 等紧邻核心的位置

### AI Coding Agent工作流程

```
提交任务 → 监控进度 → 代码审查 → 合并PR → 推送GitHub → 继续下一批
```

---

## 参考文档

- [docs/GameDesign.md](docs/GameDesign.md) - 游戏设计文档
